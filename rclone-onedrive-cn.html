<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Cache-Control" content="no-siteapp">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1, minimum-scale=1, maximum-scale=1">
<meta name="renderer" content="webkit">
<meta name="google" value="notranslate">
<meta name="robots" content="index,follow">


<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="567899.xyz">
<meta name="twitter:description" content="这家伙很赖，什么也没有留下。">
<meta name="twitter:image:src" content="https://567899.xyz/images/avatar.png">

<meta property="og:url" content="https://567899.xyz">
<meta property="og:title" content="567899.xyz">
<meta property="og:description" content="这家伙很赖，什么也没有留下。">
<meta property="og:site_name" content="567899.xyz">
<meta property="og:image" content="https://567899.xyz/images/avatar.png">
<meta property="og:type" content="website">
<meta name="robots" content="noodp">

<meta itemprop="name" content="567899.xyz">
<meta itemprop="description" content="这家伙很赖，什么也没有留下。">
<meta itemprop="image" content="https://567899.xyz/images/avatar.png">

<link rel="canonical" href="https://567899.xyz">

<link rel="shortcut icon" href="/favicon.png">
<link rel="apple-itouch-icon" href="/favicon.png">
<link rel="stylesheet" href="/bundle/index.css">
<script type="text/javascript">
    var timeSinceLang = {
        year: '年前',
        month: '个月前',
        day: '天前',
        hour: '小时前',
        minute: '分钟前',
        second: '秒前'
    };
    var root = '';
</script>


        <meta name="keywords" content="rclone,onedrive,">
        <meta name="description" content="使用Rclone挂载世纪互联OneDrive">
        <meta name="author" content="567899.xyz">
        <title>使用Rclone挂载世纪互联OneDrive</title>
    </head>
    <body>
        <article class="container">
            <header class="header-wrap">
  <a class="index" href="/">
    <img class="logo" src="/images/avatar.png" />
    567899.xyz
  </a>
  <ul class="menu">
      <li class="menu-item"><a href="/archive.html">归档</a></li>
      <li class="menu-item"><a href="/tag.html">标签</a></li>
      <li class="menu-item"><a href="/atom.xml">订阅</a></li>
  </ul>
</header>

            <article class="main article">
                <h1 class="title">使用Rclone挂载世纪互联OneDrive</h1>
                <section class="info">
                    <span class="avatar" style="background-image: url(/images/avatar.png);"></span>
                    <a class="name" href="/about.me.html">567899.xyz</a>
                    
                    <span class="date" data-time="1580547600"><span class="from"></span></span>
                    
                    <span class="tags"><a class="tag" href="/tag/rclone/index.html">rclone</a><a class="tag" href="/tag/onedrive/index.html">onedrive</a></span>
                </section>
                <article class="content"><h4>世纪互联 OneDrive 获取 CLIENT_ID 及 CLIENT_SECRET</h4>

<p>打开 <a href="https://portal.azure.cn/">https://portal.azure.cn/</a> 登陆并按以下步骤：</p>

<ol>
<li>左侧找到 <code>Azure Active Directory</code> 点击</li>
<li>左侧找到 <a href="https://portal.azure.cn/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredApps">应用注册</a></li>
<li>上方找到 <code>新注册</code> 点击</li>
<li>名称：<code>onedrive</code></li>
<li>受支持的账户类型：    <code>任何组织目录(任何 Azure AD 目录 - 多租户)中的帐户</code>（第二个）</li>
<li>重定向 URL：<code>http://localhost:53682</code></li>
<li>点击注册 找到 <code>应用程序(客户端) ID</code>  <strong>复制client_ID保存</strong></li>
<li>左侧找到 <code>证书和密码</code> 点击</li>
<li>下方 <code>客户端密码</code> - <code>新客户端密码</code></li>
<li>说明：<code>onedrive</code></li>
<li>截止期限：默认 <code>1年内</code></li>
<li>点击 添加，<code>值</code> 客户端密码  <strong>复制client_secret保存</strong></li>
<li>左侧找到 <code>API 权限</code> 点击</li>
<li><code>添加权限</code>  - <code>Microsoft Graph</code> - <code>委托的权限</code> - <code>Files (7)</code>全部勾选</li>
<li>选择<code>应用程序权限</code> 在下方<code>Files</code>里选择 <code>Files.Read.All</code>和<code>Files.ReadWrite.All</code></li>
</ol>

<p>回到界面会发现该权限处于未授权状态，<strong>我们需要全局管理员点击</strong>  <code>代表XXXX授予管理员同意</code></p>

<pre><code class="language-bash">Files.Read
Files.Read.All
Files.Read.Selected
Files.ReadWrite
Files.ReadWrite.All
Files.ReadWrite.AppFolder
Files.ReadWrite.Selected
</code></pre>

<h4>安装配置 Rclone</h4>

<p>Rclone 世纪互联版地址：<a href="https://www.hostloc.com/thread-612579-1-1.html">兼容世纪互联的 Rclone</a></p>

<p>预编译兼容世纪互联的 Rclone v1.50.2</p>

<p><a href="/uploads/rclone-v1.50.2-linux-386-21vianet.zip">Linux 32位</a> | <a href="/uploads/rclone-v1.50.2-linux-amd64-21vianet.zip">Linux 64位</a> | <a href="/uploads/rclone-v1.50.2-windows-386-21vianet.zip">Windows 32位</a> | <a href="/uploads/rclone-v1.50.2-windows-amd64-21vianet.zip">Windows 64位</a></p>

<p>下载解压上传到 <code>/usr/bin</code> 目录，然后</p>

<pre><code class="language-bash">chmod +x /usr/bin/rclone
rclone config
</code></pre>

<p>完整配置过程如下</p>

<pre><code class="language-bash">Microsoft Windows [版本 10.0.17763.316]
(c) 2018 Microsoft Corporation。保留所有权利。

C:\Users\user&gt;cd C:\Users\user\Desktop\rclone-v1.50.2-windows-amd64-21vianet

C:\Users\user\Desktop\rclone-v1.50.2-windows-amd64-21vianet&gt;rclone config
2020/02/01 13:46:21 NOTICE: Config file &quot;C:\\Users\\user\\.config\\rclone\\rclone.conf&quot; not found - using defaults
No remotes found - make a new one
n) New remote
s) Set configuration password
q) Quit config
n/s/q&gt; n
name&gt; onedrive_cn
Type of storage to configure.
Enter a string value. Press Enter for the default (&quot;&quot;).
Choose a number from below, or type in your own value
 1 / 1Fichier
   \ &quot;fichier&quot;
 2 / Alias for an existing remote
   \ &quot;alias&quot;
 3 / Amazon Drive
   \ &quot;amazon cloud drive&quot;
 4 / Amazon S3 Compliant Storage Provider (AWS, Alibaba, Ceph, Digital Ocean, Dreamhost, IBM COS, Minio, etc)
   \ &quot;s3&quot;
 5 / Backblaze B2
   \ &quot;b2&quot;
 6 / Box
   \ &quot;box&quot;
 7 / Cache a remote
   \ &quot;cache&quot;
 8 / Citrix Sharefile
   \ &quot;sharefile&quot;
 9 / Dropbox
   \ &quot;dropbox&quot;
10 / Encrypt/Decrypt a remote
   \ &quot;crypt&quot;
11 / FTP Connection
   \ &quot;ftp&quot;
12 / Google Cloud Storage (this is not Google Drive)
   \ &quot;google cloud storage&quot;
13 / Google Drive
   \ &quot;drive&quot;
14 / Google Photos
   \ &quot;google photos&quot;
15 / Hubic
   \ &quot;hubic&quot;
16 / JottaCloud
   \ &quot;jottacloud&quot;
17 / Koofr
   \ &quot;koofr&quot;
18 / Local Disk
   \ &quot;local&quot;
19 / Mail.ru Cloud
   \ &quot;mailru&quot;
20 / Mega
   \ &quot;mega&quot;
21 / Microsoft Azure Blob Storage
   \ &quot;azureblob&quot;
22 / Microsoft OneDrive
   \ &quot;onedrive&quot;
23 / OpenDrive
   \ &quot;opendrive&quot;
24 / Openstack Swift (Rackspace Cloud Files, Memset Memstore, OVH)
   \ &quot;swift&quot;
25 / Pcloud
   \ &quot;pcloud&quot;
26 / Put.io
   \ &quot;putio&quot;
27 / QingCloud Object Storage
   \ &quot;qingstor&quot;
28 / SSH/SFTP Connection
   \ &quot;sftp&quot;
29 / Transparently chunk/split large files
   \ &quot;chunker&quot;
30 / Union merges the contents of several remotes
   \ &quot;union&quot;
31 / Webdav
   \ &quot;webdav&quot;
32 / Yandex Disk
   \ &quot;yandex&quot;
33 / http Connection
   \ &quot;http&quot;
34 / premiumize.me
   \ &quot;premiumizeme&quot;
Storage&gt; 22
** See help for onedrive backend at: https://rclone.org/onedrive/ **

Microsoft App Client Id
Leave blank normally.
Enter a string value. Press Enter for the default (&quot;&quot;).
client_id&gt; 6b57cb03-3791-4823-9ce9-5dd027e*****
Microsoft App Client Secret
Leave blank normally.
Enter a string value. Press Enter for the default (&quot;&quot;).
client_secret&gt; l05:IBoAAVh4]Y]4M_?9lgw-L8******
OneDrive operated by 21Vianet (世纪互联).
Enter a boolean value (true or false). Press Enter for the default (&quot;false&quot;).
is_21vianet_version&gt; true
Edit advanced config? (y/n)
y) Yes
n) No
y/n&gt; y
Chunk size to upload files with - must be multiple of 320k (327,680 bytes).

Above this size files will be chunked - must be multiple of 320k (327,680 bytes). Note
that the chunks will be buffered into memory.
Enter a size with suffix k,M,G,T. Press Enter for the default (&quot;10M&quot;).
chunk_size&gt; 10M
The ID of the drive to use
Enter a string value. Press Enter for the default (&quot;&quot;).
drive_id&gt;
The type of the drive ( personal | business | documentLibrary )
Enter a string value. Press Enter for the default (&quot;&quot;).
drive_type&gt; business
Set to make OneNote files show up in directory listings.

By default rclone will hide OneNote files in directory listings because
operations like &quot;Open&quot; and &quot;Update&quot; won't work on them.  But this
behaviour may also prevent you from deleting them.  If you want to
delete OneNote files or otherwise want them to show up in directory
listing, set this option.
Enter a boolean value (true or false). Press Enter for the default (&quot;false&quot;).
expose_onenote_files&gt;
Remote config
Make sure your Redirect URL is set to &quot;http://localhost:53682/&quot; in your custom config.
Use auto config?
 * Say Y if not sure
 * Say N if you are working on a remote or headless machine
y) Yes
n) No
y/n&gt; Y
If your browser doesn't open automatically go to the following link: http://127.0.0.1:53682/auth?state=3-n1fmI2XA7QsjnhQAjoQw
Log in and authorize rclone for access
Waiting for code...
Got code
Choose a number from below, or type in an existing value
 1 / OneDrive Personal or Business
   \ &quot;onedrive&quot;
 2 / Root Sharepoint site
   \ &quot;sharepoint&quot;
 3 / Type in driveID
   \ &quot;driveid&quot;
 4 / Type in SiteID
   \ &quot;siteid&quot;
 5 / Search a Sharepoint site
   \ &quot;search&quot;
Your choice&gt; 1
Found 1 drives, please select the one you want to use:
0: OneDrive (business) id=b!Yb3jWYP2_EOgiOjYxlsv4iz1Y8ZSfhlEm48kp98Ew0Dzv4TUrSwSSK1sL5j*****
Chose drive to use:&gt; 0
Found drive 'root' of type 'business', URL: https://*****-my.sharepoint.cn/personal/***_****_partner_onmschina_cn/Documents
Is that okay?
y) Yes
n) No
y/n&gt; y
--------------------
[onedrive_cn]
type = onedrive
client_id = 6b57cb03-3791-4823-9ce9-5dd027e*****
client_secret = l05:IBoAAVh4]Y]4M_?9lgw-L8******
is_21vianet_version = true
chunk_size = 10M
drive_type = business
token = {&quot;access_token&quot;:&quot;eyJ0eXAiOiJKV1Q********BtBs2OM8B1Euv7SAA&quot;,&quot;expiry&quot;:&quot;2020-02-01T14:50:32.8151941+08:00&quot;}
drive_id = b!Yb3jWYP2_EOgiOjYxlsv4iz1Y8****************UrSwSSK1sL5jmrG0I
--------------------
y) Yes this is OK
e) Edit this remote
d) Delete this remote
y/e/d&gt; y
Current remotes:

Name                 Type
====                 ====
onedrive_cn        onedrive

e) Edit existing remote
n) New remote
d) Delete remote
r) Rename remote
c) Copy remote
s) Set configuration password
q) Quit config
e/n/d/r/c/s/q&gt; q
</code></pre>

<p>配置文件<code>C:\Users\user\.config\rclone\rclone.conf</code>格式如下</p>

<pre><code class="language-bash">[onedrive_cn]
type = onedrive
client_id = 6b57cb03-3791-4823-9ce9-5dd027e*****
client_secret = l05:IBoAAVh4]Y]4M_?9lgw-L8******
is_21vianet_version = true
chunk_size = 10M
drive_type = business
token = {&quot;access_token&quot;:&quot;eyJ0eXAiOiJKV1Q********BtBs2OM8B1Euv7SAA&quot;,&quot;expiry&quot;:&quot;2020-02-01T14:50:32.8151941+08:00&quot;}
drive_id = b!Yb3jWYP2_EOgiOjYxlsv4iz1Y8****************UrSwSSK1sL5jmrG0I
</code></pre>

<h4>挂载</h4>

<pre><code class="language-bash">apt -y update &amp;&amp; apt install fuse
</code></pre>

<p>挂载命令：</p>

<pre><code class="language-bash">rclone mount onedrive:/ /mnt/ --copy-links --no-gzip-encoding --no-check-certificate --allow-other --allow-non-empty --umask 000
</code></pre>

<p>后台挂载命令：</p>

<pre><code class="language-bash">nohup rclone mount onedrive:/ /mnt --copy-links --no-gzip-encoding --no-check-certificate --allow-other --allow-non-empty --umask 000 &gt;/dev/null 2&gt;&amp;1 &amp;
</code></pre>

<p>卸载命令：</p>

<pre><code class="language-bash">fusermount -qzu LocalFolder onedrive
</code></pre>

<p>Rclone 开机启动（脚本来自：Rat&rsquo;s Blog，二次修改支持多网盘挂载）</p>

<pre><code class="language-bash">nano /etc/init.d/rcloned
</code></pre>

<p>文本内容如下</p>

<pre><code class="language-bash">#!/bin/bash

PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH
NAME_BIN=&quot;rclone&quot;
### BEGIN INIT INFO
# Provides:          rclone
# Required-Start:    $all
# Required-Stop:     $all
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: Start rclone at boot time
# Description:       Enable rclone by daemon.
### END INIT INFO

NAME=&quot;&quot; #rclone name名
REMOTE='' #远程文件夹
LOCAL='' #挂在地址

NAME_1=&quot;&quot;
REMOTE_1=''
LOCAL_1=''

Green_font_prefix=&quot;\033[32m&quot; &amp;&amp; Red_font_prefix=&quot;\033[31m&quot; &amp;&amp; Green_background_prefix=&quot;\033[42;37m&quot; &amp;&amp; Red_background_prefix=&quot;\033[41;37m&quot; &amp;&amp; Font_color_suffix=&quot;\033[0m&quot;
Info=&quot;${Green_font_prefix}[信息]${Font_color_suffix}&quot;
Error=&quot;${Red_font_prefix}[错误]${Font_color_suffix}&quot;
RETVAL=0

check_running(){
    PID=&quot;$(ps -C $NAME_BIN -o pid= |head -n1 |grep -o '[0-9]\{1,\}')&quot;
    if [[ ! -z ${PID} ]]; then
        return 0
    else
        return 1
    fi
}
do_start(){
    check_running
    if [[ $? -eq 0 ]]; then
        echo -e &quot;${Info} $NAME_BIN (PID ${PID}) 正在运行...&quot; &amp;&amp; exit 0
    else
        fusermount -zuq $LOCAL &gt;/dev/null 2&gt;&amp;1
        mkdir -p $LOCAL
        /usr/bin/rclone mount $NAME:$REMOTE $LOCAL --copy-links --no-gzip-encoding --no-check-certificate --allow-other --allow-non-empty --umask 000 &gt;/dev/null 2&gt;&amp;1 &amp;
        sleep 2s
        fusermount -zuq $LOCAL_1 &gt;/dev/null 2&gt;&amp;1
        mkdir -p $LOCAL_1
        /usr/bin/rclone mount $NAME_1:$REMOTE_1 $LOCAL_1 --copy-links --no-gzip-encoding --no-check-certificate --allow-other --allow-non-empty --umask 000 &gt;/dev/null 2&gt;&amp;1 &amp;
        check_running
        if [[ $? -eq 0 ]]; then
            echo -e &quot;${Info} $NAME_BIN 启动成功 !&quot;
        else
            echo -e &quot;${Error} $NAME_BIN 启动失败 !&quot;
        fi
    fi
}
do_stop(){
    check_running
    if [[ $? -eq 0 ]]; then
        kill -9 ${PID}
        RETVAL=$?
        if [[ $RETVAL -eq 0 ]]; then
            echo -e &quot;${Info} $NAME_BIN 停止成功 !&quot;
        else
            echo -e &quot;${Error} $NAME_BIN 停止失败 !&quot;
        fi
    else
        echo -e &quot;${Info} $NAME_BIN 未运行&quot;
        RETVAL=1
    fi
    fusermount -zuq $LOCAL &gt;/dev/null 2&gt;&amp;1
    fusermount -zuq $LOCAL1 &gt;/dev/null 2&gt;&amp;1
}
do_status(){
    check_running
    if [[ $? -eq 0 ]]; then
        echo -e &quot;${Info} $NAME_BIN (PID $(echo ${PID})) 正在运行...&quot;
    else
        echo -e &quot;${Info} $NAME_BIN 未运行 !&quot;
        RETVAL=1
    fi
}
do_restart(){
    do_stop
    do_start
}
case &quot;$1&quot; in
    start|stop|restart|status)
    do_$1
    ;;
    *)
    echo &quot;使用方法: $0 { start | stop | restart | status }&quot;
    RETVAL=1
    ;;
esac
exit $RETVAL
</code></pre>

<p>操作命令</p>

<pre><code class="language-bash">chmod +x /etc/init.d/rcloned
/etc/init.d/rcloned start
/etc/init.d/rcloned stop
</code></pre>
</article>
                <section class="author">
                    <div class="avatar" style="background-image: url(/images/avatar.png);"></div>
                    <a class="name" href="/about.me.html">567899.xyz</a>
                    <div class="intro">记录折腾中的点点滴滴</div>
                </section>
                <section class="recommend">
                    
                    <section class="nav prev more">
                        <div class="head">上篇文章</div>
                        <a class="link" href="/onelist.html">OneList又一款OneDrive列目录程序,解决API抽风问题</a>
                    </section>
                    
                    
                    <section class="nav next more">
                        <div class="head">下篇文章</div>
                        <a class="link" href="/cn-onedrive-oneindex.html">OneIndex搭建世纪互联版OneDrive</a>
                    </section>
                    
                </section>
                
    <section id="disqus_thread"></section>
    <script type="text/javascript">
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//vvy.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>


            </article>
        </article>
        <footer class="footer">
    <span class="copyright">
        567899.xyz ©
        <script type="text/javascript">
            document.write(new Date().getFullYear());
        </script>
    </span>
    <span class="publish">Powered by <a href="http://www.chole.io/" target="_blank">Ink</a></span>
</footer>

        <script src="/bundle/index.js"></script>
    </body>
</html>
